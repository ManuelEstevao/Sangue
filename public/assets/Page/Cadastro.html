<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../css/formulario.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <title>Cadastro</title>
    <script>
        $(document).ready(function () {
            // Função para buscar dados da API quando o campo BI perde o foco
            $('#bi').on('blur', function () {
                const bi = $(this).val();

                // Verifica se o BI tem 14 caracteres
                if (bi.length !== 14) {
                    alert("Por favor, insira um BI válido com 14 caracteres.");
                    return;
                }

                // Faz a requisição à API
                $.ajax({
                    url: `https://consulta.edgarsingui.ao/consultar/${bi}`,
                    method: 'GET',
                    dataType: 'json',
                    success: function (response) {
                        // Verifica se houve um erro na resposta da API
                        if (!response.error) {
                            // Atualiza os campos do formulário com os dados recebidos
                            $('#nome').val(response.name || 'Não encontrado');
                            $('#genero').val(response.gender || 'Não encontrado'); // Preenche o campo de gênero
                            $('#data').val(response.data_de_nascimento || 'Não encontrado');
                        } else {
                            alert("Erro: " + response.message); // Mensagem de erro da API
                        }
                    },
                    error: function (xhr, status, error) {
                        alert("Ocorreu um erro ao buscar os dados. Verifique o BI informado ou tente novamente mais tarde.");
                    }
                });
            });
        });
    </script>
</head>
<body>
    <main>
        <header>
            <h2>Registrar-se</h2>
        </header>
        <form id="form" class="form" action="../PHP/cadastrar.php" method="post">
            <div class="control">
                <input 
                    type="text" 
                    id="bi" 
                    name="bi" 
                    placeholder="Bilhete de identidade" 
                    required  
                    maxlength="14"
                >
                <small>Mensagem de Erro</small>
            </div>
            <div class="control">
                <input 
                    type="text" 
                    id="nome" 
                    name="nome" 
                    placeholder="Nome Completo" 
                    required 
                    readonly
                >
                <small>Mensagem de Erro</small>
            </div>
            <div class="control">
                <input 
                    type="text" 
                    id="genero" 
                    name="genero" 
                    placeholder="Gênero" 
                    required 
                    readonly
                >
                <small>Mensagem de Erro</small>
            </div>
            <div class="control">
                <input 
                    type="text" 
                    id="data" 
                    name="data" 
                    placeholder="Data de Nascimento" 
                    required 
                    readonly
                >
                <small>Mensagem de Erro</small>
            </div>
            <div class="control">
                <input 
                    type="text" 
                    id="tisangue" 
                    name="tisangue" 
                    placeholder="Tipo Sanguíneo" 
                    required
                >
                <small>Mensagem de Erro</small>
            </div>

            <div class="control">
                <input 
                    type="email" 
                    id="email" 
                    name="email" 
                    placeholder="Email" 
                    required
                >
                <small>Mensagem de Erro</small>
            </div>
            
            <div class="control">
                <input 
                    type="number" 
                    id="contacto" 
                    name="contacto" 
                    placeholder="Contacto" 
                    minlength="9" 
                    required
                >
                <small>Mensagem de Erro</small>
            </div>
            
            <div class="control">
                <input 
                    type="password" 
                    id="senha" 
                    name="senha" 
                    placeholder="Senha" 
                    required
                >
                <small>Mensagem de Erro</small>
            </div>
            
            <div class="control">
                <input 
                    type="password" 
                    id="confSenha" 
                    name="confSenha" 
                    placeholder="Confirmar a Senha" 
                    required
                >
                <small>Mensagem de Erro</small>
            </div>
            <div class="btn">
                <button type="submit">Registrar</button>
            </div>
        </form>
    </main>
</body>
</html>